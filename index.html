<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PSC Guru ‚Äî Kerala PSC Exam Prep</title>
  <meta name="description" content="Kerala PSC Quiz App" />
  <style>
    :root{
      --bg:#eef7ef;
      --card:#ffffff;
      --brand:#2a7f3f;
      --text:#183420;
      --muted:#6a7f71;
      --accent:#f0fff4;
      --shadow:0 8px 24px rgba(0,0,0,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
    }
    .container{max-width:1120px;margin:0 auto;padding:28px 20px}
    header{
      background:linear-gradient(0deg,#e6f3e7,#e2f0e4);
      border-bottom:1px solid rgba(0,0,0,.05);
    }
    .nav{
      display:flex;align-items:center;justify-content:space-between;gap:16px;
    }
    .brand{display:flex;align-items:center;gap:12px;font-weight:800}
    .logo{
      width:40px;height:40px;border-radius:12px;background:#d7f2dc;color:#185b2b;
      display:grid;place-items:center;font-weight:900;box-shadow:var(--shadow)
    }
    .navlinks{display:flex;gap:10px;flex-wrap:wrap}
    .pill{
      appearance:none;border:none;border-radius:999px;padding:8px 14px;
      background:#fff;box-shadow:var(--shadow);color:var(--text);text-decoration:none;font-weight:600
    }
    .pill:hover{filter:brightness(.98)}
    h1{font-size:28px;margin:18px 0 8px}
    .muted{color:var(--muted)}

    /* Quick quiz */
    .row{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width:820px){.row{grid-template-columns:1fr 1fr}}
    .qq-card{
      background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:18px 18px 18px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px
    }
    .qq-left{display:flex;align-items:center;gap:12px}
    .qq-ico{
      width:44px;height:44px;border-radius:12px;background:#ffe6e6;display:grid;place-items:center;font-size:22px
    }
    .qq-ico.bot{background:#e7ecff}
    .qq-title{font-weight:800}
    .qq-sub{font-size:13px;color:var(--muted)}
    .qq-right .pill{font-weight:700}

    /* Categories */
    .section-head{display:flex;align-items:center;gap:14px}
    .count-badge{
      display:inline-grid;place-items:center;
      min-width:28px;height:28px;border-radius:999px;background:#fff;box-shadow:var(--shadow);
      font-weight:800;color:var(--brand)
    }
    .search{
      margin-top:12px;margin-bottom:10px;
      width:100%;max-width:420px;padding:10px 12px;border-radius:12px;border:1px solid #dfe7e2;background:#fff
    }
    .banner{margin:8px 0;padding:12px 14px;border-radius:12px;border:1px solid #e8d5b8;background:#fff6e6;color:#7a4d00}
    .cat-grid{
      margin-top:8px;
      display:grid;grid-template-columns:1fr;gap:14px
    }
    @media (min-width:760px){.cat-grid{grid-template-columns:repeat(2,1fr)}}
    @media (min-width:1080px){.cat-grid{grid-template-columns:repeat(3,1fr)}}
    .cat-card{
      display:block;background:var(--card);border-radius:14px;box-shadow:var(--shadow);
      padding:16px 16px 14px 16px;text-decoration:none;color:inherit;transition:transform .06s ease;
      border:1px solid #e9efe9
    }
    .cat-card:hover{transform:translateY(-2px)}
    .cat-card__title{font-weight:800;margin:4px 0}
    .cat-card__meta{font-size:12px;color:var(--muted)}
    footer{padding:36px 0 24px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo">PSC</div>
        <div>
          <div style="font-weight:800">PSC Guru</div>
          <div class="muted" style="font-size:12px;margin-top:2px">Kerala PSC Exam Prep</div>
        </div>
      </div>
      <nav class="navlinks">
        <a class="pill" href="quiz.html">Quiz</a>
        <a class="pill" href="resources.html">Study</a>
        <a class="pill" href="notices.html">Notices</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>Quick Quiz</h1>
    <div class="muted">Start instantly: random questions or play ‚ÄúAI vs You‚Äù.</div>

    <div class="row" style="margin-top:12px">
      <!-- Random -->
      <div class="qq-card">
        <div class="qq-left">
          <div class="qq-ico">üé≤</div>
          <div>
            <div class="qq-title">Random Quiz</div>
            <div class="qq-sub">Mixed questions across all categories</div>
          </div>
        </div>
        <div class="qq-right">
          <a class="pill" href="quiz.html?mode=random">Start</a>
        </div>
      </div>
      <!-- AI -->
      <div class="qq-card">
        <div class="qq-left">
          <div class="qq-ico bot">ü§ñ</div>
          <div>
            <div class="qq-title">AI vs You</div>
            <div class="qq-sub">Computer guesses vs your answers (timed)</div>
          </div>
        </div>
        <div class="qq-right">
          <a class="pill" href="quiz.html?mode=ai">Play</a>
        </div>
      </div>
    </div>

    <h1 style="margin-top:28px" class="section-head">
      Quiz Categories
      <span class="count-badge" data-cat-count>0</span>
    </h1>
    <input id="search" class="search" placeholder="Search category..." />

    <div id="cat-error" class="banner" hidden>
      Unable to load category list. Please either <b>Publish the sheet to the web</b> (entire document),
      or create a tab named <b>Categories</b> with a <code>name</code> column.
    </div>

    <div id="cat-grid" class="cat-grid"></div>
  </main>

  <footer>
    ¬© <span id="year"></span> PSC Guru ‚Ä¢ Tea Green UI
  </footer>

  <script>
    /* ============== CONFIG ============== */
    // Your Google Sheet (document) ID
    const GS_SHEET_ID = "16iIOLKAkFzXD1ja7v6b7_ZUKVjbcsswX8LfJ_D0S57o";

    // Tabs we ignore when falling back to the worksheet feed:
    const EXCLUDE_TABS = new Set([
      "Categories","Study Material","Exam Notifications","Resources",
      "README","Config","Sample","Sheet1","Sheet2"
    ]);

    /* ============ Utilities ============ */
    const $ = (sel,root=document)=>root.querySelector(sel);
    const $$ = (sel,root=document)=>[...root.querySelectorAll(sel)];
    $("#year").textContent = new Date().getFullYear();

    // Very small CSV splitter that preserves quoted commas
    function csvToRows(csv) {
      const lines = csv.trim().split(/\r?\n/);
      return lines.map(line =>
        line.match(/("([^"]|"")*"|[^,])+/g)?.map(c => c.replace(/^"|"$/g,'').replace(/""/g,'"')) ?? []
      );
    }

    function renderCategories(names) {
      const grid = $("#cat-grid");
      grid.innerHTML = "";
      names.forEach(name => {
        const a = document.createElement("a");
        a.className = "cat-card";
        a.href = `quiz.html?mode=category&sheet=${encodeURIComponent(name)}`;
        a.innerHTML = `
          <div class="cat-card__title">${name}</div>
          <div class="cat-card__meta">From Google Sheets</div>
        `;
        grid.appendChild(a);
      });
      // Update count + hide banner
      const badge = document.querySelector("[data-cat-count]");
      if (badge) badge.textContent = names.length;
      const warn = $("#cat-error");
      if (warn) warn.hidden = true;
    }

    async function tryCategoriesCSV() {
      const url = `https://docs.google.com/spreadsheets/d/${GS_SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Categories`;
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("CSV HTTP " + res.status);
      const csv = await res.text();
      const rows = csvToRows(csv);
      if (!rows.length) throw new Error("CSV empty");
      const header = rows.shift().map(h => h.trim().toLowerCase());
      const nameIdx = header.indexOf("name");
      if (nameIdx === -1) throw new Error("CSV has no 'name' column");
      const names = [...new Set(rows.map(r => (r[nameIdx] || "").trim()).filter(Boolean))];
      if (!names.length) throw new Error("CSV has no names");
      return names;
    }

    async function tryWorksheetFeed() {
      const url = `https://spreadsheets.google.com/feeds/worksheets/${GS_SHEET_ID}/public/values?alt=json`;
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("Feed HTTP " + res.status);
      const j = await res.json();
      const names = j.feed.entry.map(e => e.title.$t)
        .filter(n => n && !EXCLUDE_TABS.has(n));
      if (!names.length) throw new Error("Feed empty");
      return names;
    }

    async function loadCategories() {
      const warn = $("#cat-error");
      const badge = document.querySelector("[data-cat-count]");
      if (badge) badge.textContent = "0";
      if (warn) warn.hidden = false;

      // 1) Try Categories tab (CSV)
      try {
        const names = await tryCategoriesCSV();
        renderCategories(names);
        return;
      } catch (e) {
        console.warn("Categories CSV failed:", e);
      }
      // 2) Fallback to worksheet feed
      try {
        const names = await tryWorksheetFeed();
        renderCategories(names);
      } catch (e) {
        console.error("Worksheet feed failed:", e);
        // keep warning visible
      }
    }

    // Search filter
    $("#search").addEventListener("input", e=>{
      const q = e.target.value.trim().toLowerCase();
      $$(".cat-card").forEach(card=>{
        const name = $(".cat-card__title", card).textContent.toLowerCase();
        card.style.display = name.includes(q) ? "" : "none";
      });
    });

    document.addEventListener("DOMContentLoaded", loadCategories);
  </script>
</body>
</html>
