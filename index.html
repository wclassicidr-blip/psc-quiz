<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Quizon ‚Äî Home</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f7f6ff;
    --card:#ffffff;
    --ink:#18202b;
    --muted:#7a8896;
    --border:rgba(0,0,0,.08);
    --shadow:0 24px 60px rgba(25,20,60,.15);

    --purple:#7f5fff;
    --purple-2:#6238ff;
    --purple-3:#985eff;
    --accent:#28d0a0;

    --surface:#ffffffcc;
  }
  @media (prefers-color-scheme:dark){
    :root{
      --bg:#0d0a19;
      --card:#15132a;
      --ink:#f5f6ff;
      --muted:#c7c9d6;
      --border:rgba(255,255,255,.12);
      --shadow:0 24px 60px rgba(0,0,0,.55);
      --surface:#0d0a19cc;
    }
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:400 15.5px/1.55 Inter,system-ui;overflow-x:hidden}

  /* App frame (centers on desktop, full-width on phones) */
  .app{max-width:980px;margin:0 auto;padding:16px 12px 96px}

  /* Top ‚Äúapp header‚Äù */
  .topbar{
    position:sticky;top:0;z-index:50;height:56px;
    display:flex;align-items:center;justify-content:center;
    background:var(--surface);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)
  }
  .brand{font:800 18px/1 Inter;letter-spacing:.2px;display:flex;gap:10px;align-items:center}
  .brand i{width:28px;height:28px;border-radius:9px;display:grid;place-items:center;background:#fff;border:1px solid var(--border)}
  @media (prefers-color-scheme:dark){ .brand i{background:#0f0c23} }

  /* Purple header card */
  .hero{
    margin:14px 0 12px;padding:18px;border-radius:22px;color:#fff;box-shadow:var(--shadow);
    background: radial-gradient(1200px 400px at -10% 0%, #a07aff, #7f5fff 60%, #6b4bff);
  }
  .hero-head{display:flex;align-items:center;gap:12px}
  .avatar{width:44px;height:44px;border-radius:14px;background:#ffffff24;display:grid;place-items:center;font-size:24px}
  .hero-title{font:800 18px/1.2 Inter}
  .hero-sub{opacity:.95;font-size:13px;margin-top:4px}
  .bell{margin-left:auto;width:36px;height:36px;border-radius:12px;background:#ffffff24;display:grid;place-items:center}

  /* Mode cards row */
  .modes{display:flex;gap:10px;overflow:auto;padding:6px 0 2px;scroll-snap-type:x mandatory}
  .mode{scroll-snap-align:start;flex:0 0 clamp(160px, 27vw, 220px);background:#fff;border:1px solid var(--border);border-radius:18px;padding:12px 12px 10px;color:#18202b;box-shadow:var(--shadow)}
  .mode .tag{font:800 11px/1.2 Inter;color:#7a8896}
  .mode .name{margin:4px 0 6px;font:800 16px/1.2 Inter}
  .mode .art{height:80px;border-radius:12px;background:linear-gradient(135deg,#ffe2f2,#ffd3e8);display:grid;place-items:center;font-size:38px;border:1px solid var(--border)}
  .mode.blue .art{background:linear-gradient(135deg,#e6f2ff,#e3e8ff)}
  .mode.green .art{background:linear-gradient(135deg,#d9ffe9,#c9ffe6)}

  /* Search input pill */
  .search{
    display:flex;align-items:center;gap:10px;margin:12px 0 6px;background:#fff;border:1px solid var(--border);
    border-radius:14px;padding:10px 12px;box-shadow:var(--shadow)
  }
  .search input{border:none;outline:none;background:transparent;flex:1;font:600 14px/1 Inter;color:var(--ink)}
  .search i{opacity:.7}

  /* Section + grid */
  .section{margin-top:12px}
  .section h3{margin:0 0 10px;font:800 16px/1.2 Inter;display:flex;align-items:center}
  .section h3 a{margin-left:auto;color:#fff;background:linear-gradient(90deg,var(--purple-3),var(--purple));padding:6px 10px;border-radius:12px;font-size:12px}

  .grid{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
  @media (min-width:560px){ .grid{grid-template-columns:repeat(3,1fr)} }
  @media (min-width:860px){ .grid{grid-template-columns:repeat(4,1fr)} }

  .cat{
    background:var(--card);border:1px solid var(--border);border-radius:18px;padding:10px;box-shadow:var(--shadow);
    display:grid;grid-template-columns:auto 1fr;grid-template-rows:auto auto;gap:6px;align-items:center;min-width:0
  }
  .cat .icon{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;font-size:24px;border:1px solid var(--border);
    background:linear-gradient(135deg,#f4f6ff,#fff)}
  .cat .title{font:800 14.5px/1.2 Inter;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .cat .desc{grid-column:1/3;color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

  /* Random Quiz tile styling */
  .cat.random{background:linear-gradient(180deg,#ffe9f7,#fff);border-color:#ffd5ef}
  @media (prefers-color-scheme:dark){
    .mode,.search,.cat{background:#15132a;color:var(--ink)}
    .cat.random{background:linear-gradient(180deg,#321d4a,#1a1430);border-color:#3b2a60}
  }

  /* Bottom purple nav (mobile) */
  .nav{position:fixed;left:0;right:0;bottom:0;height:64px;background:linear-gradient(90deg,#7f5fff,#6238ff);display:grid;grid-template-columns:repeat(3,1fr);z-index:60}
  .nav a{display:grid;place-items:center;color:#fff;text-decoration:none;font-size:12px;font-weight:800}
  .nav a i{font-size:18px;display:block;margin-bottom:2px}

  /* Cards never cause page overflow */
  .grid, .modes { min-width:0 }
  html, body { overflow-x:hidden }

  /* Debug popup shows only on errors */
  #debug{position:fixed;right:10px;bottom:10px;background:#fff;border:1px solid #f0c6c6;border-radius:10px;padding:8px 10px;
    box-shadow:0 12px 30px rgba(0,0,0,.14);display:none;z-index:2000;color:#7a2f2f;font:12px/1.4 Inter}
  #debug pre{margin:6px 0 0;max-height:180px;overflow:auto;white-space:pre-wrap}
</style>
</head>
<body>

<!-- App top bar -->
<div class="topbar">
  <div class="brand"><i>‚ùì</i> Quizon</div>
</div>

<div class="app">
  <!-- Purple header (no points/rank) -->
  <section class="hero">
    <div class="hero-head">
      <div class="avatar">üë©‚Äçüéì</div>
      <div>
        <div class="hero-title">Hello, <span id="playerName">Player</span></div>
        <div class="hero-sub">Let‚Äôs play quiz</div>
      </div>
      <div class="bell">üîî</div>
    </div>

    <!-- Modes -->
    <div class="modes" style="margin-top:12px">
      <a class="mode pink" href="quiz.html?mode=random&n=10">
        <div class="tag">START</div>
        <div class="name">Solo<br/>Mode</div>
        <div class="art">üßë‚Äçüíª</div>
      </a>

      <a class="mode blue" href="#">
        <div class="tag">START</div>
        <div class="name">Multiplayer<br/>Mode</div>
        <div class="art">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
      </a>

      <a class="mode green" href="#">
        <div class="tag">START</div>
        <div class="name">1 Vs. 1<br/>Mode</div>
        <div class="art">‚öîÔ∏è</div>
      </a>
    </div>
  </section>

  <!-- Search -->
  <div class="search">
    <i>üîé</i>
    <input id="q" placeholder="Search Quiz Categories" />
  </div>

  <!-- Explore -->
  <section class="section">
    <h3>Explore Categories <a href="#" id="viewAll">VIEW ALL</a></h3>
    <div class="grid" id="grid">
      <!-- JS renders here -->
    </div>
  </section>
</div>

<!-- Bottom purple nav -->
<nav class="nav">
  <a href="#"><i>üîé</i>Search</a>
  <a href="#"><i>üë•</i>Groups</a>
  <a href="profile.html"><i>üë§</i>Profile</a>
</nav>

<!-- Debug popup -->
<div id="debug"><b>Page error</b><pre id="dbgText"></pre></div>

<script>
(function(){
  /* ============== CONFIG ============== */
  // Put your Google Sheet ID here (or keep '' to use only the local list).
  const SHEET_ID = ''; // e.g. '1dLIO...yourSheetId...'
  const TRY_TABS = ['Categories','Category','Index'];

  // Local fallback categories ‚Äî make sure 'sheet' matches your quiz sheet tab.
  const LOCAL = [
    { title:'Start Random Quiz', sheet:'__RANDOM__', emoji:'üßë‚Äçüè´', desc:'Pick any topic',   random:true },
    { title:'Sports',            sheet:'Sports',      emoji:'‚öΩ',   desc:'All about sports', date:'2025-01-23' },
    { title:'Space',             sheet:'Space',       emoji:'üöÄ',   desc:'Planets & space',  date:'2025-01-18' },
    { title:'Maths',             sheet:'Maths',       emoji:'üßÆ',   desc:'Numbers & logic',  date:'2025-01-15' },
    { title:'History',           sheet:'History',     emoji:'üõ°Ô∏è',  desc:'Past & events',    date:'2024-12-09' },
  ];
  /* ==================================== */

  // Never-blank-screen error catcher
  const dbg = document.getElementById('debug'), dbgText = document.getElementById('dbgText');
  function showErr(e){ dbg.style.display='block'; dbgText.textContent = (e && (e.stack||e.message||e)) + ''; }
  window.onerror = (m, s, l, c, e)=>{ showErr(e||m); };
  window.onunhandledrejection = (ev)=>{ showErr(ev.reason||ev); };

  const $  = (s,el=document)=>el.querySelector(s);
  const $$ = (s,el=document)=>[...el.querySelectorAll(s)];

  // Load name
  const playerName = localStorage.getItem('psc_name') || 'Player';
  $('#playerName').textContent = playerName;

  // Helpers
  function stripGVizJSON(txt){ const s=txt.indexOf('{'), e=txt.lastIndexOf('}'); return JSON.parse(txt.slice(s,e+1)); }
  async function gviz(sheetId, tab){
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${encodeURIComponent(tab)}&tq=${encodeURIComponent("select *")}`;
    const res = await fetch(url,{cache:"no-store"}); if(!res.ok) throw new Error('GViz '+res.status);
    const raw = await res.text(); const json = stripGVizJSON(raw);
    const cols = json.table.cols.map(c => (c.label||"").trim().toLowerCase());
    const rows = json.table.rows.map(r => (r.c||[]).map(c => (c&&c.v)!=null ? String(c.v) : ""));
    return {cols, rows};
  }
  function pickIndex(cols, rx){ return cols.findIndex(c => rx.some(r=>r.test(c))); }
  function toTs(v){
    if(!v) return NaN; if(/^\d{13}$/.test(v)) return +v; if(/^\d{10}$/.test(v)) return +v*1000;
    const d = new Date(String(v).replaceAll('.', '/').replaceAll('-', '/')); const t=+d; return Number.isFinite(t)?t:NaN;
  }

  function renderCategories(list){
    const grid = $('#grid'); grid.innerHTML = '';
    // Always put the Random tile first
    const random = list.find(x=>x.random) || { title:'Start Random Quiz', sheet:'__RANDOM__', emoji:'üßë‚Äçüè´', desc:'Pick any topic', random:true };
    const rest = list.filter(x=>x!==random);

    // Random tile
    const r = document.createElement('a');
    r.className = 'cat random';
    r.href = '#'; r.onclick = (e)=>{ e.preventDefault(); startRandom(); };
    r.innerHTML = `<div class="icon">ü§î</div><div class="title">${random.title}</div><div class="desc">${random.desc||''}</div>`;
    grid.appendChild(r);

    // The rest
    rest.forEach(x=>{
      const a = document.createElement('a');
      a.className = 'cat';
      a.href = x.sheet==='__RANDOM__' ? '#' : `quiz.html?sheet=${encodeURIComponent(x.sheet)}`;
      if(x.sheet==='__RANDOM__'){ a.addEventListener('click', (e)=>{e.preventDefault(); startRandom();}); }
      a.innerHTML = `<div class="icon">${x.emoji||'üéØ'}</div><div class="title" title="${x.title}">${x.title}</div><div class="desc">${x.desc||''}</div>`;
      grid.appendChild(a);
    });
  }

  function filterCategories(q){
    q = q.toLowerCase();
    $$('.cat').forEach(el=>{
      const t = el.querySelector('.title')?.textContent.toLowerCase()||'';
      const d = el.querySelector('.desc')?.textContent.toLowerCase()||'';
      el.style.display = (t.includes(q) || d.includes(q)) ? '' : 'none';
    });
  }

  function startRandom(){
    // Choose a random category (excluding the random tile)
    const cards = $$('.cat:not(.random)');
    if(!cards.length){ alert('No categories found'); return; }
    const pick = cards[Math.floor(Math.random()*cards.length)];
    pick.click();
  }

  async function loadCategories(){
    let list = [];
    if(SHEET_ID){
      for(const tab of TRY_TABS){
        try{
          const {cols, rows} = await gviz(SHEET_ID, tab);
          const iName  = pickIndex(cols, [/^name$|^title$|^category$/]);
          const iSheet = pickIndex(cols, [/sheet|tab|get/]);
          const iDesc  = pickIndex(cols, [/^desc$|^description$|about|note/]);
          const iDate  = pickIndex(cols, [/date|updated|created|modified|timestamp|release|added|time/]);

          list = rows.map((r,idx)=>({
            title:(r[iName]||'').trim(),
            sheet:(r[iSheet]||'').trim(),
            desc: iDesc>-1 ? (r[iDesc]||'').trim() : '',
            emoji:'üß†',
            ts: Number.isFinite(toTs(r[iDate])) ? toTs(r[iDate]) : (rows.length-idx)*60_000
          })).filter(x=>x.title && x.sheet);

          if(list.length) break;
        }catch(_){ /* try next tab */ }
      }
    }

    if(!list.length){
      list = LOCAL.map((x,i)=>({...x, ts: x.date ? toTs(x.date) : (LOCAL.length - i) * 60_000}));
    }

    // Sort newest first for ‚ÄúExplore‚Äù order (after the Random tile)
    const sorted = list.slice().sort((a,b)=> (b.ts||0)-(a.ts||0));

    // Ensure a random tile exists
    const withRandom = [{ title:'Start Random Quiz', sheet:'__RANDOM__', emoji:'üßë‚Äçüè´', desc:'Pick any topic', random:true }, ...sorted];

    renderCategories(withRandom);
  }

  // Search
  $('#q').addEventListener('input', e=>filterCategories(e.target.value));
  $('#viewAll').addEventListener('click', e=>{ e.preventDefault(); $('#q').value=''; filterCategories(''); });

  // Boot
  try{
    loadCategories();
  }catch(e){ showErr(e); }
})();
</script>
</body>
</html>
