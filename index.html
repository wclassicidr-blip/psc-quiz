<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PSC Guru ‚Äî Kerala PSC Exam Prep</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="header.css">
  <script defer src="site-header.js"></script>
  <style>
    :root{--bg:#f2f8f4;--bg-2:#eaf4ef;--glass:rgba(255,255,255,.85);--glass-2:rgba(255,255,255,.95);--text:#0f2d1f;--muted:#5f726a;--brand:#0f8346;--brand-600:#0b5f34;--ring:rgba(15,131,70,.22);--shadow:0 20px 40px rgba(30,70,50,.15);--r:18px;}
    *{box-sizing:border-box} body{margin:0;font:400 16px/1.55 Inter,system-ui;color:var(--text);background:linear-gradient(180deg,var(--bg),var(--bg-2));}
    .wrap{max-width:1200px;margin:0 auto;padding:22px 18px 72px}
    .nav{max-width:1200px;margin:0 auto;padding:12px 18px; display:flex;align-items:center;gap:12px;}
    .brand{display:flex;align-items:center;gap:12px;padding:8px 10px;border-radius:14px;background:var(--glass-2); box-shadow:var(--shadow);}
    .logo{height:38px;width:38px;border-radius:12px;display:grid;place-items:center;font-weight:900;color:#fff;background:linear-gradient(160deg,#0dcf8b,#0b8f6b);}
    .brand h1{font-size:18px;margin:0;font-weight:800;letter-spacing:.2px}
    .brand small{display:block;margin-top:-2px;font-size:12px;color:var(--muted);font-weight:600}
    .links{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap}
    .pill{padding:8px 14px;border-radius:999px;background:var(--glass-2);font-weight:700;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.06);color:var(--text); text-decoration:none;}
    .pill.active{background:linear-gradient(180deg,var(--brand),var(--brand-600)); color:#062016}
    .hero{position:relative;overflow:hidden;border-radius:22px;padding:28px 22px;background:var(--glass);border:1px solid rgba(0,0,0,.06);box-shadow:var(--shadow);margin-top:16px;}
    .hero h2{font-size:28px;margin:0 0 6px;font-weight:800;letter-spacing:.2px}
    .cards{display:grid;grid-template-columns:1fr; gap:16px; margin-top:16px}
    @media(min-width:860px){.cards{grid-template-columns:1fr 1fr}}
    .card{background:#fff;border:1px solid rgba(0,0,0,.06); border-radius:18px; padding:18px 16px; box-shadow: var(--shadow);}
    .chipbar{display:flex;gap:10px;margin:12px 0 14px;flex-wrap:wrap}
    .chip{border:1px solid rgba(0,0,0,.08);background:transparent;color:var(--text); border-radius:999px;padding:9px 12px;font-weight:800;cursor:pointer;letter-spacing:.3px}
    .chip.active{background:#34d399;border-color:transparent;color:#032015;box-shadow:0 0 0 8px var(--ring)}
    .row{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:12px}
    .btn{display:inline-flex;align-items:center;gap:8px;font-weight:900;padding:10px 16px;border-radius:12px;border:none;background:linear-gradient(180deg,#34d399,#059669);color:#062016;cursor:pointer;box-shadow:0 10px 25px var(--ring)}
    .btn--ghost{background:transparent;border:1px solid rgba(0,0,0,.18);color:var(--text)}
    .btn-sm{padding:8px 12px;border-radius:999px}
    .toolbar{display:flex;gap:14px;align-items:center;margin-top:24px;margin-bottom:10px;position:sticky;top:70px;z-index:3}
    .toolbar .title{font-size:22px;margin:0;font-weight:800}
    .toolbar .count{color:var(--muted);font-weight:800}
    .search{margin-left:auto;display:flex;align-items:center;gap:10px;background:var(--glass-2);border:1px solid rgba(0,0,0,.06);border-radius:999px;padding:10px 14px;backdrop-filter: blur(8px);box-shadow:var(--shadow);max-width:560px;width:100%}
    .search input{border:none;outline:none;background:transparent;color:inherit;font:inherit;width:100%}
    .grid-cats{display:grid;grid-template-columns:1fr;gap:14px;margin-top:10px}
    @media(min-width:640px){.grid-cats{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:980px){.grid-cats{grid-template-columns:repeat(3,1fr)}}
    .cat{position:relative;border-radius:16px;border:1px solid rgba(0,0,0,.1);background:#fff;padding:14px 14px 16px;box-shadow:var(--shadow);min-height:110px;overflow:hidden}
    .cat h3{margin:0 0 6px;font-weight:800}
    .cat p{margin:0;color:#5f726a;font-size:14px}
    .stretched{position:absolute;inset:0}
    .skeleton{animation:shimmer 1.2s linear infinite;background: linear-gradient(90deg, rgba(0,0,0,.04), rgba(0,0,0,.08), rgba(0,0,0,.04)); background-size: 200% 100%; border-radius:14px;height:110px;border:1px solid rgba(0,0,0,.06)}
    @keyframes shimmer{0%{background-position:-120% 0}100%{background-position:120% 0}}
    footer{margin-top:32px;color:#5f726a;font-size:13px;text-align:center}
    .splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.15);backdrop-filter: blur(6px);opacity:0;pointer-events:none;transition:opacity .25s ease; z-index:1000;}
    .splash.on{opacity:1;pointer-events:auto}
    .sp-card{background:#fff;border:1px solid rgba(0,0,0,.06);padding:18px 22px;border-radius:14px; box-shadow:var(--shadow);display:flex;align-items:center;gap:12px;color:#0f2d1f;font-weight:800}
    .spinner{width:22px;height:22px;border-radius:50%;border:3px solid rgba(15,131,70,.25);border-top-color:#0f8346;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="nav">
      <a href="index.html" class="brand" aria-label="PSC Guru Home">
        <div class="logo">PSC</div>
        <div><h1>PSC Guru</h1><small>Kerala PSC Exam Prep</small></div>
      </a>
      <nav class="links" aria-label="Primary">
        <a class="pill active" href="index.html">Quiz</a>
        <a class="pill" href="resources.html">Study</a>
        <a class="pill" href="notices.html">Notices</a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <section class="hero">
      <h2>Quick Quiz</h2>
      <p>Start fast: Random Quiz or face the bot in ‚ÄúAI vs You‚Äù.</p>
      <div class="cards">
        <article class="card">
          <h3>üé≤ Random Quiz</h3>
          <p>Start instantly with mixed questions (random category).</p>
          <div class="chipbar" id="chips">
            <button class="chip active" data-n="5">5</button>
            <button class="chip" data-n="10">10</button>
            <button class="chip" data-n="20">20</button>
            <button class="chip" data-n="30">30</button>
            <button class="chip" data-n="N">N</button>
          </div>
          <div class="row"><span style="color:#5f726a;font-weight:700">How many questions?</span><button class="btn btn-sm" id="startRandom">Start</button></div>
        </article>
        <article class="card" id="aiCard">
          <h3>ü§ñ AI vs You</h3><p>Timed MCQ ‚Äî open any category below.</p>
          <div class="row"><button class="btn btn-sm btn--ghost" id="aiInfo">Info</button><button class="btn btn-sm" id="aiPlay">Play</button></div>
        </article>
        <article class="card"><h3>üìö Study Material</h3><p>Downloadable PDFs & docs curated in Google Sheets.</p><div class="row"><span></span><a class="btn btn-sm btn--ghost" href="resources.html">Open</a></div></article>
        <article class="card"><h3>üîî Exam Notifications</h3><p>Latest notifications for Kerala PSC exams.</p><div class="row"><span></span><a class="btn btn-sm btn--ghost" href="notices.html">Open</a></div></article>
      </div>
    </section>

    <div class="toolbar" id="gridTop">
      <h3 class="title">Quiz Categories <span class="count" id="catCount">(0)</span></h3>
      <label class="search" title="Search category">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-3.5-3.5M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="q" type="search" placeholder="Search category‚Ä¶" />
      </label>
    </div>

    <section class="grid-cats" id="cats" aria-live="polite" aria-busy="true">
      <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
      <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
    </section>
    <footer>¬© 2025 PSC Guru ‚Ä¢ Tea Green UI</footer>
  </div>

  <div class="splash" id="splash" aria-hidden="true">
    <div class="sp-card"><div class="spinner" aria-hidden="true"></div><span id="splashLabel">Loading categories‚Ä¶</span></div>
  </div>

  <script>
    const GS_SHEET_ID = "16iIOLKAkFzXD1ja7v6b7_ZUKVjbcsswX8LfJ_D0S57o";
    const GS_PUB_EKEY = "2PACX-1vR4PuWTfq2838_kUaKcwmeWlKb5OtEmL6YqUX4DjPcrb6EaJfW-monSIqbZTiI3ZFrE6GBFHaP7k95A";
    const CATEGORIES_TAB = "Categories";

    let selectedN = 5;
    document.querySelectorAll('#chips .chip').forEach(ch=>{
      ch.addEventListener('click', ()=>{
        document.querySelectorAll('#chips .chip').forEach(c=>c.classList.remove('active'));
        ch.classList.add('active'); selectedN = ch.dataset.n;
      });
    });
    document.getElementById('startRandom').addEventListener('click', ()=>{
      location.href = `quiz.html?mode=random&n=${encodeURIComponent(selectedN)}`;
    });
    document.getElementById('aiInfo').addEventListener('click', ()=>{
      alert("Open any category below and start. Add ?timer=300 to quiz URL for a 5-minute timer.");
    });
    document.getElementById('aiPlay').addEventListener('click', ()=>{
      document.getElementById('gridTop').scrollIntoView({behavior:"smooth", block:"start"});
      document.getElementById('aiCard').animate([{transform:"scale(1)"},{transform:"scale(1.02)"},{transform:"scale(1)"}], {duration:500});
    });

    const splash = document.getElementById('splash'); const splashLabel = document.getElementById('splashLabel');
    const showSplash = (on, text="Loading‚Ä¶") => { if(splashLabel) splashLabel.textContent = text; splash.classList.toggle('on', !!on); };

    function stripGVizJSON(txt){ const s=txt.indexOf('{'), e=txt.lastIndexOf('}'); return JSON.parse(txt.slice(s,e+1)); }
    function splitCSV(line){ const re=/(?:[^,"\\]|\\.|"(?:\\.|[^"])*")+/g; return (line.match(re)||[]).map(s=>s.replace(/^"|"$/g,"").trim()); }
    function parseCSV(text){ const lines=text.split(/\r?\n/).filter(l=>l.trim()!==""); if(!lines.length) return {head:[], rows:[]}; const head=splitCSV(lines.shift()); const rows=lines.map(splitCSV); return {head, rows}; }
    const norm = s => (s||"").toLowerCase().trim();

    async function fetchCSVItems(){
      if(!GS_PUB_EKEY) return [];
      const url = `https://docs.google.com/spreadsheets/d/e/${GS_PUB_EKEY}/pub?output=csv&sheet=${encodeURIComponent(CATEGORIES_TAB)}`;
      const res = await fetch(url, {cache:"no-store"}); if(!res.ok) throw new Error("CSV fetch failed");
      const txt = await res.text(); const {head, rows} = parseCSV(txt);
      const h = head.map(norm);
      let idxName = h.findIndex(x=>x.startsWith('name')); if(idxName<0) idxName=0;
      let idxTab  = h.findIndex(x=> x.includes('get')||x.includes('sheet')||x.includes('tab')); if(idxTab<0) idxTab=1;
      let idxDesc = h.findIndex(x=>x.startsWith('desc'));
      return rows.map(r => ({ name:(r[idxName]||"").trim(), sheet:(r[idxTab]||"").trim(), desc: idxDesc>-1 ? (r[idxDesc]||"").trim():""})).filter(x=>x.sheet);
    }
    async function gviz(tab){
      const url = `https://docs.google.com/spreadsheets/d/${GS_SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(tab)}&tq=${encodeURIComponent("select *")}`;
      const res = await fetch(url,{cache:"no-store"}); if(!res.ok) throw new Error("GViz failed");
      const raw = await res.text(); const json = stripGVizJSON(raw);
      const cols = json.table.cols.map(c => (c.label||"").trim());
      const rows = json.table.rows.map(r => (r.c||[]).map(c => (c&&c.v)!=null ? String(c.v) : ""));
      return {cols, rows};
    }

    async function loadCategories(){
      showSplash(true, "Loading categories‚Ä¶");
      const cont  = document.getElementById('cats'); const count = document.getElementById('catCount');
      let items = [];
      try{ items = await fetchCSVItems(); }catch(e){ console.warn("CSV failed:", e.message); }
      if(!items.length){
        try{ const {cols, rows} = await gviz(CATEGORIES_TAB); const h=cols.map(norm);
          let idxName=h.findIndex(x=>x.startsWith('name')); if(idxName<0) idxName=0;
          let idxTab=h.findIndex(x=>x.includes('get')||x.includes('sheet')||x.includes('tab')); if(idxTab<0) idxTab=1;
          items = rows.map(r=>({name:(r[idxName]||"").trim(), sheet:(r[idxTab]||"").trim(), desc:""})).filter(x=>x.sheet);
        }catch(e){ console.warn("GViz fallback failed:", e.message); }
      }
      showSplash(false);
      cont.setAttribute('aria-busy','false');
      if(!items.length){
        count.textContent="(0)";
        cont.innerHTML = `<article class="cat" role="alert"><h3>Couldn‚Äôt load categories</h3><p>Make sure the sheet is <b>Published to the web</b> (entire document) and the tab is named <b>${CATEGORIES_TAB}</b>.</p></article>`;
        return;
      }
      cont.innerHTML = items.map(x => `<article class="cat"><a class="stretched" href="quiz.html?sheet=${encodeURIComponent(x.sheet)}"></a><h3>${x.name||x.sheet}</h3><p>${x.desc||"From Google Sheets"}</p></article>`).join("");
      count.textContent = `(${items.length})`;
      document.getElementById('q').addEventListener('input', (e)=>{
        const q = e.target.value.toLowerCase();
        [...document.querySelectorAll('.cat')].forEach(card=>{
          const t = card.querySelector('h3').textContent.toLowerCase();
          card.style.display = t.includes(q) ? "" : "none";
        });
      });
    }
    loadCategories();
  </script>
</body>
</html>
