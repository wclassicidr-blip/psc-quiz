<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="header.css">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PSC Guru ‚Äî Kerala PSC Exam Prep</title>

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #f7f4ff;
      --bg-soft: #f1f4ff;
      --card: rgba(255,255,255,.88);
      --card-strong: #ffffff;
      --stroke: rgba(124,99,255,.18);
      --text:#1d1556;
      --muted:#6f6a96;
      --brand:#7c63ff;
      --brand-600:#5b4dff;
      --brand-700:#4a3adb;
      --accent:#ff8bd3;
      --shadow: 0 24px 60px rgba(91,77,255,.16);
      --shadow-soft:0 16px 40px rgba(120,99,255,.12);
      --radius:22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font:400 16px/1.55 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:var(--text);
      background:
        radial-gradient(460px 320px at 15% 0%, rgba(255,139,211,.22), transparent),
        radial-gradient(540px 360px at 85% -10%, rgba(124,99,255,.25), transparent),
        var(--bg);
      position:relative;
      overflow-x:hidden;
    }
    body::before, body::after{
      content:"?";
      position:fixed;
      font-size:180px;
      font-weight:800;
      color:rgba(124,99,255,.08);
      transform:rotate(-12deg);
      z-index:0;
    }
    body::before{top:14vh;left:-40px;}
    body::after{bottom:10vh;right:-20px;transform:rotate(18deg);}

    .wrap{max-width:1100px;margin:0 auto;padding:28px 18px 80px;position:relative;z-index:1}

    .hero{
      display:grid;
      gap:18px;
      padding:26px 24px 30px;
      border-radius:var(--radius);
      background:linear-gradient(145deg, rgba(124,99,255,.18), rgba(255,255,255,.88));
      border:1px solid var(--stroke);
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
      margin-top:18px;
    }
    .hero::after{
      content:"";
      position:absolute;inset:auto -140px -140px auto;
      width:320px;height:320px;border-radius:50%;
      background:radial-gradient(closest-side, rgba(124,99,255,.55), transparent 72%);
      opacity:.6;
      filter:blur(6px);
    }
    .hero h2{margin:0;font-size:30px;font-weight:800;letter-spacing:.3px}
    .hero p{margin:0;color:var(--muted);max-width:540px}

    .hero-top{display:flex;align-items:flex-start;gap:12px;flex-wrap:wrap}
    .hero-badges{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    .badge{
      display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:999px;
      background:rgba(255,255,255,.8);
      border:1px solid var(--stroke);
      font-weight:700;color:var(--muted);font-size:13px;
    }
    .badge svg{width:18px;height:18px;color:var(--brand)}

    .cards{display:grid;gap:16px;margin-top:10px}
    @media(min-width:880px){.cards{grid-template-columns:repeat(2, minmax(0,1fr));}}
    @media(min-width:1100px){.cards{grid-template-columns:repeat(4, minmax(0,1fr));}}

    .card{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      padding:18px 18px 20px;
      box-shadow:var(--shadow-soft);
      position:relative;
      overflow:hidden;
      min-height:168px;
      display:flex;flex-direction:column;gap:12px;
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .card::after{
      content:"";
      position:absolute;right:-60px;top:-40px;width:160px;height:160px;border-radius:50%;
      background:radial-gradient(closest-side, rgba(124,99,255,.22), transparent 70%);
    }
    .card h3{margin:0;font-size:18px;font-weight:800;position:relative;z-index:1}
    .card p{margin:0;color:var(--muted);font-size:14px;line-height:1.6;position:relative;z-index:1}
    .card .row{position:relative;z-index:1}
    .card:hover{transform:translateY(-4px);box-shadow:0 30px 60px rgba(91,77,255,.18)}

    .chipbar{display:flex;gap:10px;flex-wrap:wrap}
    .chip{
      border:1px solid rgba(124,99,255,.25);
      background:rgba(255,255,255,.75);
      color:var(--brand-700);
      border-radius:999px;
      padding:8px 16px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s ease;
    }
    .chip.active{background:linear-gradient(135deg,var(--brand),var(--brand-600));color:#fff;box-shadow:0 12px 26px rgba(91,77,255,.25);}

    .row{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .btn{
      display:inline-flex;align-items:center;gap:8px;
      font-weight:800;
      padding:10px 18px;
      border-radius:14px;
      border:none;
      background:linear-gradient(135deg,var(--brand),var(--brand-600));
      color:#fff;
      cursor:pointer;
      box-shadow:0 18px 30px rgba(91,77,255,.25);
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .btn svg{stroke:#fff}
    .btn:hover{transform:translateY(-2px);box-shadow:0 22px 38px rgba(91,77,255,.28)}
    .btn--ghost{
      background:rgba(255,255,255,.85);
      border:1px solid rgba(124,99,255,.28);
      color:var(--brand-700);
      box-shadow:none;
    }
    .btn--ghost svg{stroke:var(--brand-700)}
    .btn-sm{padding:8px 14px;border-radius:12px;font-size:14px}

    .toolbar{
      margin-top:36px;
      margin-bottom:12px;
      display:flex;
      gap:16px;
      align-items:center;
      flex-wrap:wrap;
      position:sticky;
      top:90px;
      z-index:5;
    }
    .toolbar .title{margin:0;font-size:24px;font-weight:800}
    .toolbar .count{color:var(--muted);font-weight:700}

    .search{
      margin-left:auto;
      display:flex;align-items:center;gap:10px;
      background:rgba(255,255,255,.92);
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:10px 16px;
      box-shadow:var(--shadow-soft);
      max-width:420px;width:100%;
    }
    .search input{border:none;outline:none;background:transparent;color:var(--text);font:inherit;width:100%}
    .search svg{color:var(--muted)}

    .grid-cats{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:720px){.grid-cats{grid-template-columns:repeat(2,minmax(0,1fr));}}
    @media(min-width:1080px){.grid-cats{grid-template-columns:repeat(3,minmax(0,1fr));}}
    .cat{
      position:relative;
      border-radius:20px;
      border:1px solid var(--stroke);
      background:var(--card-strong);
      padding:18px 18px 20px;
      box-shadow:var(--shadow-soft);
      overflow:hidden;
      min-height:120px;
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .cat::after{
      content:"";position:absolute;right:-48px;bottom:-48px;width:160px;height:160px;border-radius:50%;
      background:radial-gradient(closest-side, rgba(124,99,255,.18), transparent 70%);
    }
    .cat h3{margin:0 0 8px;font-weight:800;font-size:18px}
    .cat p{margin:0;color:var(--muted);font-size:14px}
    .cat:hover{transform:translateY(-4px);box-shadow:0 28px 60px rgba(91,77,255,.18)}
    .stretched{position:absolute;inset:0}

    .skeleton{
      border-radius:20px;
      height:120px;
      background:linear-gradient(90deg, rgba(255,255,255,.4), rgba(233,227,255,.9), rgba(255,255,255,.4));
      background-size:200% 100%;
      animation:shimmer 1.2s linear infinite;
      border:1px solid rgba(124,99,255,.12);
    }
    @keyframes shimmer{0%{background-position:-120% 0}100%{background-position:120% 0}}

    footer{margin-top:40px;color:var(--muted);font-size:13px;text-align:center}

    .splash{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
      background:rgba(26,16,94,.32);
      backdrop-filter:blur(8px);
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
      z-index:1000;
    }
    .splash.on{opacity:1;pointer-events:auto}
    .sp-card{
      background:rgba(255,255,255,.9);
      border-radius:18px;
      padding:18px 22px;
      border:1px solid var(--stroke);
      box-shadow:var(--shadow);
      display:flex;align-items:center;gap:12px;
      color:var(--text);
      font-weight:700;
    }
    .spinner{width:22px;height:22px;border-radius:50%;border:3px solid rgba(124,99,255,.2);border-top-color:var(--brand);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>
  <script defer src="site-header.js"></script>

  <!-- Reusable Sticky Header -->
  
  <!-- header injected by site-header.js -->


  <div class="wrap">

    <!-- Hero -->
    <section class="hero">
      <div class="hero-top">
        <div>
          <h2>Hi, Kency! üëã</h2>
          <p>Sharpen your Kerala PSC prep with quick quizzes, playful challenges, and curated study tools.</p>
        </div>
        <button class="btn btn-sm" id="heroPlay">Play &amp; Win</button>
      </div>
      <div class="hero-badges">
        <span class="badge"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m5 11 4 4L19 5" stroke-linecap="round" stroke-linejoin="round"/></svg>Daily streak 6</span>
        <span class="badge"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2 8.5 8.6 1 9.7l5.5 5-1.6 7.3L12 18l7.1 4-1.6-7.3L23 9.7l-7.5-1.1z" stroke-linejoin="round"/></svg>200 bonus pts</span>
        <span class="badge"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 3v18M19 3v18M9 7h6M9 12h6M9 17h6" stroke-linecap="round"/></svg>12 categories unlocked</span>
      </div>

      <div class="cards">
        <!-- Random Quiz -->
        <article class="card">
          <h3>üé≤ Random Quiz</h3>
          <p>Start instantly with mixed questions (random category).</p>
          <div class="chipbar" id="chips">
            <button class="chip active" data-n="5">5</button>
            <button class="chip" data-n="10">10</button>
            <button class="chip" data-n="20">20</button>
            <button class="chip" data-n="30">30</button>
            <button class="chip" data-n="N">N</button>
          </div>
          <div class="row">
            <span style="color:var(--muted);font-weight:700">How many questions?</span>
            <button class="btn btn-sm" id="startRandom">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M5 12h14M13 5l7 7-7 7" stroke="#032015" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Start
            </button>
          </div>
        </article>

        <!-- AI vs You -->
        <article class="card" id="aiCard">
          <h3>ü§ñ AI vs You</h3>
          <p>Timed MCQ ‚Äî the computer guesses vs your answers. Open any category below.</p>
          <div class="row">
            <button class="btn btn-sm btn--ghost" id="aiInfo">Info</button>
            <button class="btn btn-sm" id="aiPlay">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M8 5v14l11-7L8 5Z" stroke="#032015" stroke-width="2" stroke-linejoin="round"/></svg>
              Play
            </button>
          </div>
        </article>

        <!-- Study -->
        <article class="card">
          <h3>üìö Study Material</h3>
          <p>Downloadable PDFs & docs curated in Google Sheets.</p>
          <div class="row"><span></span><a class="btn btn-sm btn--ghost" href="resources.html">Open</a></div>
        </article>

        <!-- Notices -->
        <article class="card">
          <h3>üîî Exam Notifications</h3>
          <p>Latest notifications for Kerala PSC exams.</p>
          <div class="row"><span></span><a class="btn btn-sm btn--ghost" href="notices.html">Open</a></div>
        </article>
      </div>
    </section>

    <!-- Categories Toolbar -->
    <div class="toolbar" id="gridTop">
      <h3 class="title">Quiz Categories <span class="count" id="catCount">(0)</span></h3>
      <label class="search" title="Search category">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-3.5-3.5M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <input id="q" type="search" placeholder="Search category‚Ä¶" />
      </label>
    </div>

    <!-- Categories Grid -->
    <section class="grid-cats" id="cats" aria-live="polite" aria-busy="true">
      <!-- Skeletons while loading -->
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
    </section>

    <footer>¬© 2025 PSC Guru ‚Ä¢ Tea Green UI</footer>
  </div>

  <!-- Splash / loader (reuse this on other pages too) -->
  <div class="splash" id="splash" aria-hidden="true">
    <div class="sp-card">
      <div class="spinner" aria-hidden="true"></div>
      <span id="splashLabel">Loading categories‚Ä¶</span>
    </div>
  </div>

  <script>
    /* ================== CONFIG ================== */
    // Your Sheet ID + Publish-to-Web E-key
    const GS_SHEET_ID = "16iIOLKAkFzXD1ja7v6b7_ZUKVjbcsswX8LfJ_D0S57o";
    const GS_PUB_EKEY = "2PACX-1vR4PuWTfq2838_kUaKcwmeWlKb5OtEmL6YqUX4DjPcrb6EaJfW-monSIqbZTiI3ZFrE6GBFHaP7k95A";
    const CATEGORIES_TAB = "Categories";

    /* ============== UI interactions ============== */
    let selectedN = 5;
    document.querySelectorAll('#chips .chip').forEach(ch=>{
      ch.addEventListener('click', ()=>{
        document.querySelectorAll('#chips .chip').forEach(c=>c.classList.remove('active'));
        ch.classList.add('active'); selectedN = ch.dataset.n;
      });
    });

    document.getElementById('startRandom').addEventListener('click', ()=>{
      location.href = `quiz.html?mode=random&n=${encodeURIComponent(selectedN)}`;
    });

    document.getElementById('heroPlay').addEventListener('click', ()=>{
      document.getElementById('startRandom').click();
    });

    document.getElementById('aiInfo').addEventListener('click', ()=>{
      alert("AI vs You: open any category card below and start.\nTip: add ?timer=300 to the URL for a 5-minute timer.");
    });

    document.getElementById('aiPlay').addEventListener('click', ()=>{
      document.getElementById('gridTop').scrollIntoView({behavior:"smooth", block:"start"});
      document.getElementById('aiCard').animate(
        [{transform:"scale(1)"},{transform:"scale(1.02)"},{transform:"scale(1)"}],
        {duration:500}
      );
    });

    /* ============== Splash helpers ============== */
    const splash = document.getElementById('splash');
    const splashLabel = document.getElementById('splashLabel');
    function showSplash(on, text="Loading‚Ä¶"){
      if(splashLabel) splashLabel.textContent = text;
      if(splash) splash.classList.toggle('on', !!on);
    }

    /* ============== Sheets loaders ============== */
    function stripGVizJSON(txt){ const s=txt.indexOf('{'), e=txt.lastIndexOf('}'); return JSON.parse(txt.slice(s,e+1)); }

    async function gviz(tab){
      const url = `https://docs.google.com/spreadsheets/d/${GS_SHEET_ID}/gviz/tq?sheet=${encodeURIComponent(tab)}&tq=${encodeURIComponent("select *")}`;
      const res = await fetch(url,{cache:"no-store"}); if(!res.ok) throw new Error("GViz fetch failed");
      const raw = await res.text(); const json = stripGVizJSON(raw);
      const cols = json.table.cols.map(c => (c.label||"").trim());
      const rows = json.table.rows.map(r => (r.c||[]).map(c => (c&&c.v)!=null ? String(c.v) : ""));
      return {cols, rows};
    }

    // CSV robust splitter
    function splitCSV(line){
      const re = /(?:[^,"\\]|\\.|"(?:\\.|[^"])*")+/g;
      return (line.match(re) || []).map(s => s.replace(/^"|"$/g,"").trim());
    }
    function parseCSV(text){
      const lines = text.split(/\r?\n/).filter(l => l.trim()!=="");
      if(!lines.length) return {head:[], rows:[]};
      const head = splitCSV(lines.shift());
      const rows = lines.map(splitCSV);
      return {head, rows};
    }

    const norm = s => (s||"").toLowerCase().replace(/[^a-z]/g,"");
    function pickColumns(head){
      const h = head.map(norm);
      let idxName = h.findIndex(x => x.startsWith('name'));
      let idxTab  = h.findIndex(x => x.includes('get') || x.includes('sheet') || x.includes('tab'));
      let idxDesc = h.findIndex(x => x.startsWith('desc'));
      if(idxName < 0) idxName = 0;
      if(idxTab  < 0) idxTab  = Math.min(1, head.length-1);
      if(idxDesc < 0) idxDesc = (head.length > 2 ? 2 : -1);
      return {idxName, idxTab, idxDesc};
    }
    function rowsToItems(head, rows){
      const {idxName, idxTab, idxDesc} = pickColumns(head);
      return rows.map(r => ({
        name:  (r[idxName] || "").trim(),
        sheet: (r[idxTab]  || "").trim(),
        desc:  idxDesc > -1 ? (r[idxDesc] || "").trim() : ""
      })).filter(x => x.name && x.sheet);
    }

    async function fetchCSVItems(){
      if(!GS_PUB_EKEY) return [];
      const url = `https://docs.google.com/spreadsheets/d/e/${GS_PUB_EKEY}/pub?output=csv&sheet=${encodeURIComponent(CATEGORIES_TAB)}`;
      const res = await fetch(url, {cache:"no-store"});
      if(!res.ok) throw new Error("CSV fetch failed");
      const txt = await res.text();
      const {head, rows} = parseCSV(txt);
      return rowsToItems(head, rows);
    }

    /* ============== Load & render categories ============== */
    async function loadCategories(){
      showSplash(true, "Loading categories‚Ä¶");
      const cont  = document.getElementById('cats');
      const count = document.getElementById('catCount');

      let items = [];
      // Preferred: publish-to-web CSV
      try{ items = await fetchCSVItems(); }
      catch(e){ console.warn("CSV failed:", e.message); }

      // Fallback: GViz
      if(!items.length){
        try{
          const {cols, rows} = await gviz(CATEGORIES_TAB);
          items = rowsToItems(cols, rows);
        }catch(e){ console.warn("GViz failed:", e.message); }
      }

      showSplash(false);

      if(!items.length){
        cont.setAttribute('aria-busy','false');
        count.textContent = "(0)";
        cont.innerHTML = `
          <article class="cat" role="alert">
            <h3>Couldn‚Äôt load categories</h3>
            <p>Make sure the sheet is <b>Published to the web</b> (entire document) and the tab is named <b>${CATEGORIES_TAB}</b>.
            Also verify sharing is ‚ÄúAnyone with link: Viewer‚Äù.</p>
          </article>`;
        return;
      }

      cont.setAttribute('aria-busy','false');
      cont.innerHTML = items.map(x => `
        <article class="cat">
          <a class="stretched" href="quiz.html?sheet=${encodeURIComponent(x.sheet)}"></a>
          <h3>${x.name}</h3>
          <p>${x.desc || "From Google Sheets"}</p>
        </article>
      `).join("");
      count.textContent = `(${items.length})`;

      // Search/filter
      document.getElementById('q').addEventListener('input', (e)=>{
        const q = e.target.value.toLowerCase();
        [...document.querySelectorAll('.cat')].forEach(card=>{
          const t = card.querySelector('h3').textContent.toLowerCase();
          card.style.display = t.includes(q) ? "" : "none";
        });
      });
    }

    
    // Random Quiz controls
    (function(){
      const chips = document.getElementById('chips');
      const startBtn = document.getElementById('startRandom');
      if(!chips || !startBtn) return;
      let selectedN = chips.querySelector('.chip.active')?.dataset.n || '5';
      chips.addEventListener('click', (e)=>{
        const btn = e.target.closest('.chip');
        if(!btn) return;
        chips.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
        btn.classList.add('active');
        selectedN = btn.dataset.n;
      });
      startBtn.addEventListener('click', ()=>{
        // Navigate to quiz with random mode and chosen N
        const url = new URL('quiz.html', location.href);
        url.searchParams.set('mode','random');
        url.searchParams.set('n', selectedN);
        location.href = url.toString();
      });
    })();

    // Kickoff
    loadCategories();
  </script>
</body>
</html>
