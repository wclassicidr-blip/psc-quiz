<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PSC Guru â€¢ Resources</title>
<style>
  :root{--bg:#f2f8f4;--card:#fff;--ink:#113b2f;--muted:#58736c;--line:#e6eee9}
  *{box-sizing:border-box} html,body{margin:0}
  body{font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  .wrap{max-width:1100px;margin:0 auto;padding:24px}
  .pill{background:#fff;border:1px solid var(--line);border-radius:999px;padding:6px 12px;text-decoration:none;color:var(--ink)}
  h1{margin:10px 0 16px}
  .cards{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:780px){.cards{grid-template-columns:1fr 1fr}}
  .card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px;text-decoration:none;color:var(--ink)}
  .muted{color:#58736c;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div style="display:flex;gap:10px">
    <a class="pill" href="index.html">Home</a>
    <a class="pill" href="quiz.html">Quiz</a>
  </div>
  <h1 id="title">Resources</h1>
  <div id="warn"></div>
  <div id="host" class="cards"></div>
</div>

<script>
const SHEET_ID = "16iIOLKAkFzXD1ja7v6b7_ZUKVjbcsswX8LfJ_D0S57o";
const TAB = new URLSearchParams(location.search).get('tab') === 'notices' ? 'Exam Notifications' : 'Study Material';

async function fetchText(u){const r=await fetch(u,{cache:'no-store'});if(!r.ok) throw new Error(r.statusText);return r.text();}
function parseCSV(t){const R=[];let i=0,f='',r=[],q=false;const pf=()=>{r.push(f);f='';};const pr=()=>{R.push(r);r=[];};while(i<t.length){const c=t[i];if(q){if(c=='"'&&t[i+1]=='"'){f+='"';i+=2;continue}if(c=='"'){q=false;i++;continue}f+=c;i++;continue}if(c=='"'){q=true;i++;continue}if(c==','){pf();i++;continue}if(c=='\r'){i++;continue}if(c=='\n'){pf();pr();i++;continue}f+=c;i++}pf();pr();return R;}
async function csvBySheet(sheet){const u=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheet)}`;return parseCSV(await fetchText(u));}

const host=document.getElementById('host'), warn=document.getElementById('warn');
document.getElementById('title').textContent = TAB;

(async()=>{
  try{
    const rows = await csvBySheet(TAB);
    const H = rows[0].map(h=>h.toLowerCase());
    const ixT = H.indexOf('title'), ixU = H.indexOf('url'), ixN = H.indexOf('notes');
    rows.slice(1).forEach(r=>{
      const t=r[ixT]||r[0], u=r[ixU], n=r[ixN]||'';
      if(!t || !u) return;
      const a=document.createElement('a');
      a.className='card'; a.href=u; a.target='_blank' rel='noopener';
      a.innerHTML=`<div style="font-weight:700">${t}</div><div class="muted">${n}</div>`;
      host.appendChild(a);
    });
  }catch(e){
    warn.textContent = 'Failed to load resources: '+e.message;
  }
})();
</script>
</body>
</html>
